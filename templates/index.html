<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Traffic Vehicle Detection - YOLOv11</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
      .video-container {
        position: relative;
        padding-bottom: 56.25%; /* 16:9 aspect ratio */
        height: 0;
        overflow: hidden;
      }
      .video-container video,
      .video-container canvas {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      .detection-box {
        position: absolute;
        border: 2px solid #3b82f6;
        background-color: rgba(59, 130, 246, 0.2);
        display: flex;
        align-items: flex-end;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 12px;
      }
      .pulse-animation {
        animation: pulse 2s infinite;
      }
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
        }
        70% {
          box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
        }
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg sticky top-0 z-50">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16 items-center">
          <div class="flex items-center">
            <i class="fas fa-car-alt text-2xl mr-2"></i>
            <span class="text-xl font-bold">TrafficVision</span>
          </div>
          <div class="hidden md:block">
            <div class="ml-10 flex items-baseline space-x-4">
              <a href="#" class="px-3 py-2 rounded-md text-sm font-medium bg-blue-700">Home</a>
              <a href="#" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-500">About</a>
              <a href="#" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-500">API</a>
              <a href="#" class="px-3 py-2 rounded-md text-sm font-medium hover:bg-blue-500">Contact</a>
            </div>
          </div>
          <div class="-mr-2 flex md:hidden">
            <button type="button" class="inline-flex items-center justify-center p-2 rounded-md text-white hover:bg-blue-500 focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
              <span class="sr-only">Open main menu</span>
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="md:flex md:items-center md:justify-between">
          <div class="md:w-1/2 mb-8 md:mb-0">
            <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl lg:text-6xl mb-4">Real-time Traffic Vehicle Detection</h1>
            <p class="text-xl mb-8">Powered by YOLOv11 deep learning model for accurate and fast vehicle detection in traffic scenarios.</p>
            <div class="flex space-x-4">
              <button class="bg-transparent border-2 border-white px-6 py-3 rounded-lg font-bold hover:bg-white hover:text-blue-600 transition duration-300 flex items-center"><i class="fas fa-info-circle mr-2"></i> Learn More</button>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Upload Section -->
    <div class="bg-gray-50 py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Process Your Own Video</h2>
          <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">Upload a video file to detect vehicles.</p>
        </div>
        <div class="mt-8 max-w-md mx-auto">
          <form action="/upload" method="post" enctype="multipart/form-data" class="bg-white p-8 rounded-xl shadow-xl space-y-6">
            <div>
              <label for="video-upload" class="block text-sm font-medium text-gray-700">Video File</label>
              <div class="mt-1 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md">
                <div class="space-y-1 text-center">
                  <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                    <path
                      d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8"
                      stroke-width="2"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                  </svg>
                  <div class="flex text-sm text-gray-600">
                    <label
                      for="video-upload"
                      class="relative cursor-pointer bg-white rounded-md font-medium text-blue-600 hover:text-blue-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-blue-500"
                    >
                      <span>Upload a file</span>
                      <input id="video-upload" name="video" type="file" class="sr-only" accept="video/*" />
                    </label>
                    <p class="pl-1">or drag and drop</p>
                  </div>
                  <p class="text-xs text-gray-500">MP4, AVI, MOV up to 500MB</p>
                </div>
              </div>
            </div>
            <button id="startDetection" type="submit" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-blue-700 transition duration-300 flex items-center justify-center pulse-animation">
              <i class="fas fa-play mr-2"></i> Start Detection
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="bg-white py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="bg-blue-50 p-6 rounded-xl text-center">
            <div class="text-blue-600 text-4xl mb-2">
              <i class="fas fa-bolt"></i>
            </div>
            <h3 class="text-lg font-bold mb-2">Real-time Processing</h3>
            <p class="text-gray-600">Processes video feed at 30+ FPS using optimized YOLOv11 model</p>
          </div>
          <div class="bg-blue-50 p-6 rounded-xl text-center">
            <div class="text-blue-600 text-4xl mb-2">
              <i class="fas fa-car"></i>
            </div>
            <h3 class="text-lg font-bold mb-2">20+ Vehicle Classes</h3>
            <p class="text-gray-600">Detects cars, trucks, buses, motorcycles, and more with high accuracy</p>
          </div>
          <div class="bg-blue-50 p-6 rounded-xl text-center">
            <div class="text-blue-600 text-4xl mb-2">
              <i class="fas fa-cloud"></i>
            </div>
            <h3 class="text-lg font-bold mb-2">Cloud Integration</h3>
            <p class="text-gray-600">Optional cloud processing for historical data and analytics</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Detection Section -->
    <div class="bg-gray-50 py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Vehicle Detection Dashboard</h2>
          <p class="mt-4 max-w-2xl text-xl text-gray-500 mx-auto">Monitor and analyze traffic patterns in real-time</p>
        </div>

        <div class="bg-white rounded-xl shadow-xl overflow-hidden">
          <div class="md:flex">
            <div class="md:w-2/3 p-4">
              <div class="video-container">
                <video id="mainVideoFeed" autoplay muted playsinline class="bg-gray-800"></video>
                <canvas id="mainDetectionCanvas"></canvas>
              </div>
            </div>
            <div class="md:w-1/3 bg-gray-100 p-6">
              <h3 class="text-xl font-bold mb-4">Detection Statistics</h3>

              <div class="mb-6">
                <div class="flex justify-between mb-2">
                  <span class="font-medium">Detection Confidence</span>
                  <span class="font-bold" id="avgConfidence">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                  <div id="confidenceBar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
              </div>

              <div class="grid grid-cols-2 gap-4 mb-6">
                <div class="bg-white p-3 rounded-lg shadow text-center">
                  <div class="text-2xl font-bold text-blue-600" id="vehicleCount">0</div>
                  <div class="text-sm text-gray-500">Vehicles Detected</div>
                </div>
                <div class="bg-white p-3 rounded-lg shadow text-center">
                  <div class="text-2xl font-bold text-blue-600" id="fpsCounter">0</div>
                  <div class="text-sm text-gray-500">Frames Per Second</div>
                </div>
              </div>

              <div class="mb-6">
                <h4 class="font-medium mb-2">Vehicle Class Distribution</h4>
                <div id="classDistribution" class="space-y-2">
                  <!-- Will be populated by JavaScript -->
                  <div class="text-sm">No detections yet</div>
                </div>
              </div>

              <div class="space-y-4">
                <button id="toggleDetection" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition flex items-center justify-center"><i class="fas fa-pause mr-2"></i> Pause Detection</button>
                <button id="captureFrame" class="w-full bg-white border border-blue-600 text-blue-600 py-2 px-4 rounded-lg hover:bg-blue-50 transition flex items-center justify-center">
                  <i class="fas fa-camera mr-2"></i> Capture Frame
                </button>
                <button id="toggleSource" class="w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition flex items-center justify-center"><i class="fas fa-exchange-alt mr-2"></i> Switch to Webcam</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- How It Works Section -->
    <div class="bg-white py-16">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="lg:text-center">
          <h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">How It Works</h2>
          <p class="mt-4 max-w-2xl text-xl text-gray-500 lg:mx-auto">The technology behind our vehicle detection system</p>
        </div>

        <div class="mt-20">
          <div class="space-y-10 md:space-y-0 md:grid md:grid-cols-3 md:gap-x-8 md:gap-y-10">
            <div class="relative">
              <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                <i class="fas fa-video"></i>
              </div>
              <div class="ml-16">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Video Input</h3>
                <p class="mt-2 text-base text-gray-500">The system accepts live video feed from traffic cameras, webcams, or uploaded video files.</p>
              </div>
            </div>

            <div class="relative">
              <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                <i class="fas fa-brain"></i>
              </div>
              <div class="ml-16">
                <h3 class="text-lg leading-6 font-medium text-gray-900">YOLOv11 Processing</h3>
                <p class="mt-2 text-base text-gray-500">Our optimized YOLOv11 model processes each frame to detect vehicles with high accuracy.</p>
              </div>
            </div>

            <div class="relative">
              <div class="absolute flex items-center justify-center h-12 w-12 rounded-md bg-blue-500 text-white">
                <i class="fas fa-chart-line"></i>
              </div>
              <div class="ml-16">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Results Visualization</h3>
                <p class="mt-2 text-base text-gray-500">Detected vehicles are highlighted with bounding boxes and classified in real-time.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-12">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h3 class="text-lg font-bold mb-4">TrafficVision</h3>
            <p class="text-gray-400">Advanced vehicle detection system powered by YOLOv11 for traffic monitoring and analysis.</p>
          </div>
          <div>
            <h3 class="text-lg font-bold mb-4">Quick Links</h3>
            <ul class="space-y-2">
              <li><a href="#" class="text-gray-400 hover:text-white">Home</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">API Documentation</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">GitHub Repository</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">Research Paper</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-bold mb-4">Resources</h3>
            <ul class="space-y-2">
              <li><a href="#" class="text-gray-400 hover:text-white">YOLOv11 Paper</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">Flask Documentation</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">OpenCV Guide</a></li>
              <li><a href="#" class="text-gray-400 hover:text-white">Model Weights</a></li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-bold mb-4">Contact</h3>
            <ul class="space-y-2">
              <li class="flex items-center text-gray-400"><i class="fas fa-envelope mr-2"></i> contact@trafficvision.ai</li>
              <li class="flex items-center text-gray-400"><i class="fas fa-phone mr-2"></i> +1 (555) 123-4567</li>
              <li class="flex items-center text-gray-400"><i class="fas fa-map-marker-alt mr-2"></i> San Francisco, CA</li>
            </ul>
          </div>
        </div>
        <div class="mt-12 pt-8 border-t border-gray-700 text-center text-gray-400">
          <p>&copy; 2023 TrafficVision. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script>
      // This is a mock implementation since actual YOLOv11 integration would require Flask backend
      // In a real implementation, you would need to:
      // 1. Set up Flask routes to handle video streaming and processing
      // 2. Implement YOLOv11 model loading and inference
      // 3. Create WebSocket or SSE for real-time updates

      document.addEventListener('DOMContentLoaded', function () {
        const videoFeed = document.getElementById('videoFeed');
        const mainVideoFeed = document.getElementById('mainVideoFeed');
        const detectionCanvas = document.getElementById('detectionCanvas');
        const mainDetectionCanvas = document.getElementById('mainDetectionCanvas');
        const startDetectionBtn = document.getElementById('startDetection');
        const toggleDetectionBtn = document.getElementById('toggleDetection');
        const captureFrameBtn = document.getElementById('captureFrame');
        const toggleSourceBtn = document.getElementById('toggleSource');
        const vehicleCountEl = document.getElementById('vehicleCount');
        const fpsCounterEl = document.getElementById('fpsCounter');
        const avgConfidenceEl = document.getElementById('avgConfidence');
        const confidenceBar = document.getElementById('confidenceBar');
        const classDistributionEl = document.getElementById('classDistribution');

        let isDetecting = false;
        let isPaused = false;
        let useWebcam = false;
        let lastTimestamp = 0;
        let frameCount = 0;
        let fps = 0;

        // Mock vehicle classes for demo
        const vehicleClasses = ['car', 'truck', 'bus', 'motorcycle', 'bicycle', 'van', 'pickup', 'suv', 'trailer', 'emergency'];

        // Mock colors for different classes
        const classColors = ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899', '#14B8A6', '#F97316', '#84CC16', '#6366F1'];

        // Start detection button click handler
        startDetectionBtn.addEventListener('click', function () {
          if (!isDetecting) {
            startDetection();
            startDetectionBtn.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Restart Detection';
            startDetectionBtn.classList.remove('pulse-animation');
          } else {
            // Restart detection
            stopDetection();
            startDetection();
          }
        });

        // Toggle detection pause/resume
        toggleDetectionBtn.addEventListener('click', function () {
          isPaused = !isPaused;
          if (isPaused) {
            toggleDetectionBtn.innerHTML = '<i class="fas fa-play mr-2"></i> Resume Detection';
          } else {
            toggleDetectionBtn.innerHTML = '<i class="fas fa-pause mr-2"></i> Pause Detection';
          }
        });

        // Capture frame button
        captureFrameBtn.addEventListener('click', function () {
          if (isDetecting) {
            const link = document.createElement('a');
            link.download = 'traffic-detection-' + new Date().toISOString() + '.png';
            link.href = mainDetectionCanvas.toDataURL('image/png');
            link.click();

            // Show notification
            showNotification('Frame captured successfully!', 'success');
          }
        });

        // Toggle video source
        toggleSourceBtn.addEventListener('click', function () {
          useWebcam = !useWebcam;
          if (useWebcam) {
            toggleSourceBtn.innerHTML = '<i class="fas fa-exchange-alt mr-2"></i> Switch to Sample Video';
            showNotification('Switched to webcam feed', 'info');
          } else {
            toggleSourceBtn.innerHTML = '<i class="fas fa-exchange-alt mr-2"></i> Switch to Webcam';
            showNotification('Switched to sample traffic video', 'info');
          }

          // Restart detection with new source
          if (isDetecting) {
            stopDetection();
            startDetection();
          }
        });

        function startDetection() {
          isDetecting = true;
          isPaused = false;

          // In a real implementation, you would connect to Flask video feed here
          // For demo purposes, we'll use a sample video and mock detections

          if (useWebcam) {
            // Try to access webcam
            navigator.mediaDevices
              .getUserMedia({ video: true })
              .then(function (stream) {
                videoFeed.srcObject = stream;
                mainVideoFeed.srcObject = stream;
              })
              .catch(function (err) {
                console.error('Error accessing webcam:', err);
                showNotification('Could not access webcam. Using sample video instead.', 'error');
                useWebcam = false;
                toggleSourceBtn.innerHTML = '<i class="fas fa-exchange-alt mr-2"></i> Switch to Webcam';
                loadSampleVideo();
              });
          } else {
            loadSampleVideo();
          }

          // Set up canvas
          detectionCanvas.classList.remove('hidden');
          mainDetectionCanvas.classList.remove('hidden');

          // Start mock detection loop
          requestAnimationFrame(detectVehicles);

          // Start FPS counter
          setInterval(updateFPS, 1000);
        }

        function loadSampleVideo() {
          // Sample traffic video
          videoFeed.src = 'https://assets.mixkit.co/videos/preview/mixkit-traffic-on-a-highway-from-a-moving-car-38745-large.mp4';
          mainVideoFeed.src = 'https://assets.mixkit.co/videos/preview/mixkit-traffic-on-a-highway-from-a-moving-car-38745-large.mp4';

          videoFeed.loop = true;
          mainVideoFeed.loop = true;

          videoFeed.play();
          mainVideoFeed.play();
        }

        function stopDetection() {
          isDetecting = false;

          if (videoFeed.srcObject) {
            videoFeed.srcObject.getTracks().forEach((track) => track.stop());
            mainVideoFeed.srcObject.getTracks().forEach((track) => track.stop());
          }

          videoFeed.src = '';
          mainVideoFeed.src = '';
        }

        function detectVehicles(timestamp) {
          if (!isDetecting) return;

          // Calculate FPS
          frameCount++;

          if (!isPaused) {
            // Get video dimensions
            const video = useWebcam ? videoFeed : mainVideoFeed;
            const canvas = useWebcam ? detectionCanvas : mainDetectionCanvas;
            const ctx = canvas.getContext('2d');

            // Set canvas dimensions to match video
            if (canvas.width !== video.videoWidth || canvas.height !== video.videoHeight) {
              canvas.width = video.videoWidth;
              canvas.height = video.videoHeight;
            }

            // Clear previous detections
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw video frame
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Mock detections - in a real app, these would come from Flask/YOLOv11
            const mockDetections = generateMockDetections(canvas.width, canvas.height);

            // Process detections
            let totalConfidence = 0;
            const classCounts = {};

            mockDetections.forEach((det) => {
              // Draw bounding box
              ctx.strokeStyle = classColors[det.classId % classColors.length];
              ctx.lineWidth = 2;
              ctx.strokeRect(det.x, det.y, det.width, det.height);

              // Draw label background
              ctx.fillStyle = classColors[det.classId % classColors.length];
              const textWidth = ctx.measureText(`${vehicleClasses[det.classId]} ${Math.round(det.confidence * 100)}%`).width;
              ctx.fillRect(det.x - 1, det.y - 20, textWidth + 10, 20);

              // Draw label text
              ctx.fillStyle = 'white';
              ctx.font = '12px Arial';
              ctx.fillText(`${vehicleClasses[det.classId]} ${Math.round(det.confidence * 100)}%`, det.x + 4, det.y - 5);

              // Update stats
              totalConfidence += det.confidence;

              if (!classCounts[det.classId]) {
                classCounts[det.classId] = 0;
              }
              classCounts[det.classId]++;
            });

            // Update UI stats
            const detectionCount = mockDetections.length;
            vehicleCountEl.textContent = detectionCount;

            const avgConfidence = detectionCount > 0 ? (totalConfidence / detectionCount) * 100 : 0;
            avgConfidenceEl.textContent = `${Math.round(avgConfidence)}%`;
            confidenceBar.style.width = `${avgConfidence}%`;

            // Update class distribution
            updateClassDistribution(classCounts);
          }

          // Continue detection loop
          requestAnimationFrame(detectVehicles);
        }

        function generateMockDetections(width, height) {
          const detections = [];
          const detectionCount = Math.floor(Math.random() * 5) + 1; // 1-5 detections

          for (let i = 0; i < detectionCount; i++) {
            const classId = Math.floor(Math.random() * vehicleClasses.length);
            const confidence = 0.7 + Math.random() * 0.3; // 70-100% confidence

            // Random position and size
            const bboxWidth = 50 + Math.random() * 150;
            const bboxHeight = 30 + Math.random() * 100;
            const x = Math.random() * (width - bboxWidth);
            const y = Math.random() * (height - bboxHeight);

            detections.push({
              classId,
              confidence,
              x,
              y,
              width: bboxWidth,
              height: bboxHeight,
            });
          }

          return detections;
        }

        function updateClassDistribution(classCounts) {
          let html = '';
          const total = Object.values(classCounts).reduce((sum, count) => sum + count, 0);

          if (total === 0) {
            html = '<div class="text-sm">No detections yet</div>';
          } else {
            for (const [classId, count] of Object.entries(classCounts)) {
              const percentage = Math.round((count / total) * 100);
              const color = classColors[classId % classColors.length];

              html += `
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 rounded-full mr-2" style="background-color: ${color};"></div>
                                    <span>${vehicleClasses[classId]}</span>
                                </div>
                                <div class="flex items-center">
                                    <span class="font-medium mr-2">${percentage}%</span>
                                    <span class="text-gray-500 text-sm">(${count})</span>
                                </div>
                            </div>
                        `;
            }
          }

          classDistributionEl.innerHTML = html;
        }

        function updateFPS() {
          fps = frameCount;
          frameCount = 0;
          fpsCounterEl.textContent = fps;
        }

        function showNotification(message, type) {
          // In a real app, you might use a proper notification library
          console.log(`${type}: ${message}`);
        }
      });
    </script>
  </body>
</html>
